<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fuerza Aérea - Sistema de Gestión</title>
    <style>
        :root {
            --primary: #1a4f85;
            --secondary: #8c2318;
            --accent: #5d8aa8;
            --light: #f4f4f4;
            --dark: #333;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
        }
        
        .view {
            display: none;
            padding: 20px;
        }
        
        .active {
            display: block;
        }
        
        /* Header y Navegación */
        header {
            background-color: var(--primary);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        nav {
            display: flex;
            gap: 15px;
        }
        
        nav button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        nav button:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        /* Formularios */
        .form-container {
            max-width: 600px;
            margin: 20px auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        
        button.secondary {
            background-color: var(--secondary);
        }
        
        /* Listas y tarjetas */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .card img {
            max-width: 100%;
            height: auto;
            border-radius: 4px;
        }
        
        /* Login */
        #loginView {
            max-width: 400px;
            margin: 50px auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        /* Perfil de piloto */
        .profile-header {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .profile-img {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .profile-info {
            flex: 1;
        }
        
        .embed-section {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        /* Tablas */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: var(--primary);
            color: white;
        }
        
        tr:hover {
            background-color: #f5f5f5;
        }
    </style>
</head>
<body>
    <!-- Vista de Login -->
    <div id="loginView" class="view active">
        <h2 style="text-align: center; margin-bottom: 20px;">Sistema de Gestión - Fuerza Aérea</h2>
        <form id="loginForm">
            <div class="form-group">
                <label for="email">Correo electrónico</label>
                <input type="email" id="email" required value="david_toro@lsaf.gov.us">
            </div>
            <div class="form-group">
                <label for="password">Contraseña</label>
                <input type="password" id="password" required value="12345">
            </div>
            <button type="submit" style="width: 100%;">Iniciar Sesión</button>
        </form>
    </div>

    <!-- Vista Principal (después del login) -->
    <div id="mainView" class="view">
        <header>
            <h1>Fuerza Aérea - Sistema de Gestión</h1>
            <nav>
                <button onclick="showView('pilotosView')">PILOTOS</button>
                <button onclick="showView('aeronavesView')">AERONAVES</button>
                <button onclick="showView('librosView')">LIBROS DE VUELO</button>
                <button onclick="showView('solicitudesView')">SOLICITUDES</button>
                <button onclick="showView('resumenView')">RESUMEN</button>
                <button onclick="showView('rangosView')">RANGOS</button>
                <button onclick="logout()">Cerrar Sesión</button>
            </nav>
        </header>

        <!-- Vista de Pilotos -->
        <div id="pilotosView" class="view">
            <h2>Gestión de Pilotos</h2>
            <button onclick="showAddPilotForm()">Agregar Piloto</button>
            <div class="card-grid" id="pilotosList">
                <!-- Los pilotos se cargarán aquí dinámicamente -->
            </div>
        </div>

        <!-- Vista de Aeronaves -->
        <div id="aeronavesView" class="view">
            <h2>Gestión de Aeronaves</h2>
            <button onclick="showAddAircraftForm()">Agregar Aeronave</button>
            <div class="card-grid" id="aeronavesList">
                <!-- Las aeronaves se cargarán aquí dinámicamente -->
            </div>
        </div>

        <!-- Vista de Libros de Vuelo -->
        <div id="librosView" class="view">
            <h2>Libros de Vuelo</h2>
            <button onclick="showAddFlightLogForm()">Agregar Libro de Vuelo</button>
            <div id="flightLogsList">
                <!-- Los libros de vuelo se cargarán aquí dinámicamente -->
            </div>
        </div>

        <!-- Vista de Solicitudes -->
        <div id="solicitudesView" class="view">
            <h2>Solicitudes de Certificación</h2>
            <button onclick="showAddRequestForm()">Solicitar Certificación</button>
            <div id="requestsList">
                <!-- Las solicitudes se cargarán aquí dinámicamente -->
            </div>
        </div>

        <!-- Vista de Resumen -->
        <div id="resumenView" class="view">
            <h2>Resumen de la Fuerza Aérea</h2>
            <div id="leadershipInfo">
                <!-- Información de liderazgo -->
            </div>
            <div id="missionVision">
                <!-- Misión y visión -->
            </div>
            <div id="flightTimesSummary">
                <!-- Resumen de tiempos de vuelo -->
            </div>
        </div>

        <!-- Vista de Rangos -->
        <div id="rangosView" class="view">
            <h2>Rangos de la Fuerza Aérea</h2>
            <button onclick="showAddRankForm()">Agregar Rango</button>
            <div class="card-grid" id="ranksList">
                <!-- Los rangos se cargarán aquí dinámicamente -->
            </div>
        </div>
    </div>

    <!-- Formularios modales (ocultos inicialmente) -->
    <div id="modalOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
        <div id="modalContent" style="background: white; width: 90%; max-width: 600px; margin: 50px auto; padding: 20px; border-radius: 8px;">
            <!-- El contenido del modal se cargará dinámicamente -->
        </div>
    </div>

    <script>
        // URL de tu Google Apps Script (debes reemplazarla con la tuya)
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyswoMxgiXip34TQIrYVI4EatXxZfN9qUgsD8QwxN6fBNfpSEnqukOPOqVh3-fwqBFAdA/exec';
        
        // Datos del usuario actual
        let currentUser = null;
        
        // Mostrar u ocultar vistas
        function showView(viewId) {
            document.querySelectorAll('.view').forEach(view => {
                view.classList.remove('active');
            });
            document.getElementById(viewId).classList.add('active');
        }
        
        // Cerrar sesión
        function logout() {
            currentUser = null;
            showView('loginView');
        }
        
        // Mostrar modal con formulario
        function showModal(html) {
            document.getElementById('modalContent').innerHTML = html;
            document.getElementById('modalOverlay').style.display = 'block';
        }
        
        // Ocultar modal
        function hideModal() {
            document.getElementById('modalOverlay').style.display = 'none';
        }
        
        // Iniciar sesión
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'login',
                        email: email,
                        password: password
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    currentUser = result.user;
                    showView('mainView');
                    loadAllData();
                } else {
                    alert('Error: ' + result.message);
                }
            } catch (error) {
                alert('Error de conexión: ' + error.message);
            }
        });
        
        // Cargar todos los datos después del login
        async function loadAllData() {
            await loadPilots();
            await loadAircrafts();
            await loadFlightLogs();
            await loadRequests();
            await loadRanks();
            await loadSummary();
        }
        
        // Cargar pilotos
        async function loadPilots() {
            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'getPilots'
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    const pilotsList = document.getElementById('pilotosList');
                    pilotsList.innerHTML = '';
                    
                    result.data.forEach(pilot => {
                        const pilotCard = document.createElement('div');
                        pilotCard.className = 'card';
                        pilotCard.innerHTML = `
                            <h3>${pilot.nombre}</h3>
                            <img src="${pilot.foto || 'placeholder.jpg'}" alt="Foto de ${pilot.nombre}">
                            <p>Rango: ${pilot.rango}</p>
                            <button onclick="showPilotDetail('${pilot.correo}')">Ver Detalles</button>
                        `;
                        pilotsList.appendChild(pilotCard);
                    });
                }
            } catch (error) {
                console.error('Error loading pilots:', error);
            }
        }
        
        // Las funciones restantes (loadAircrafts, loadFlightLogs, etc.) siguen un patrón similar
        // Implementaré las más críticas a continuación

        // Mostrar formulario para agregar piloto
        function showAddPilotForm() {
            const formHtml = `
                <h2>Agregar Nuevo Piloto</h2>
                <form onsubmit="addPilot(event)">
                    <div class="form-group">
                        <label for="newPilotEmail">Correo electrónico</label>
                        <input type="email" id="newPilotEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="newPilotPassword">Contraseña</label>
                        <input type="password" id="newPilotPassword" required>
                    </div>
                    <div class="form-group">
                        <label for="newPilotName">Nombre completo</label>
                        <input type="text" id="newPilotName" required>
                    </div>
                    <div class="form-group">
                        <label for="newPilotRank">Rango</label>
                        <select id="newPilotRank" required>
                            <!-- Las opciones se cargarán dinámicamente desde la base de datos -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="newPilotNUIM">NUIM</label>
                        <input type="text" id="newPilotNUIM" required>
                    </div>
                    <div class="form-group">
                        <label for="newPilotBirthdate">Fecha de nacimiento</label>
                        <input type="date" id="newPilotBirthdate" required>
                    </div>
                    <div class="form-group">
                        <label for="newPilotPhone">Teléfono</label>
                        <input type="tel" id="newPilotPhone" required>
                    </div>
                    <div class="form-group">
                        <label for="newPilotBloodType">Tipo de sangre</label>
                        <input type="text" id="newPilotBloodType" required>
                    </div>
                    <div class="form-group">
                        <label for="newPilotPhoto">URL de la foto</label>
                        <input type="url" id="newPilotPhoto">
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button type="submit">Agregar</button>
                        <button type="button" onclick="hideModal()">Cancelar</button>
                    </div>
                </form>
            `;
            
            showModal(formHtml);
            loadRanksForSelect('newPilotRank');
        }
        
        // Agregar piloto
        async function addPilot(event) {
            event.preventDefault();
            // Lógica para agregar piloto a la base de datos
        }
        
        // Mostrar detalles del piloto
        async function showPilotDetail(email) {
            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'getPilotDetail',
                        email: email
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    const pilot = result.data;
                    let detailHtml = `
                        <h2>Perfil de ${pilot.nombre}</h2>
                        <div class="profile-header">
                            <img src="${pilot.foto || 'placeholder.jpg'}" alt="Foto de ${pilot.nombre}" class="profile-img">
                            <div class="profile-info">
                                <p><strong>Rango:</strong> ${pilot.rango}</p>
                                <p><strong>NUIM:</strong> ${pilot.nuim}</p>
                                <p><strong>Fecha de nacimiento:</strong> ${pilot.fecha_nacimiento}</p>
                                <p><strong>Teléfono:</strong> ${pilot.telefono}</p>
                                <p><strong>Tipo de sangre:</strong> ${pilot.tipo_sangre}</p>
                            </div>
                        </div>
                    `;
                    
                    // Certificaciones
                    detailHtml += `
                        <div class="embed-section">
                            <h3>Certificaciones</h3>
                            <ul id="certificationsList">
                                ${pilot.certificaciones && pilot.certificaciones.length > 0 ? 
                                    pilot.certificaciones.map(cert => `<li>${cert.aeronave} - ${cert.fecha}</li>`).join('') : 
                                    '<li>No tiene certificaciones</li>'}
                            </ul>
                            <button onclick="showAddCertificationForm('${pilot.correo}')">Agregar Certificación</button>
                        </div>
                    `;
                    
                    // Libros de vuelo
                    detailHtml += `
                        <div class="embed-section">
                            <h3>Libros de Vuelo</h3>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Aeronave</th>
                                        <th>Fecha</th>
                                        <th>Tiempo Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${pilot.libros_vuelo && pilot.libros_vuelo.length > 0 ? 
                                        pilot.libros_vuelo.map(book => `
                                            <tr>
                                                <td>${book.aeronave}</td>
                                                <td>${book.fecha}</td>
                                                <td>${book.tiempo_total}</td>
                                            </tr>
                                        `).join('') : 
                                        '<tr><td colspan="3">No tiene libros de vuelo</td></tr>'}
                                </tbody>
                            </table>
                        </div>
                    `;
                    
                    // Solicitudes
                    detailHtml += `
                        <div class="embed-section">
                            <h3>Solicitudes de Certificación</h3>
                            <ul>
                                ${pilot.solicitudes && pilot.solicitudes.length > 0 ? 
                                    pilot.solicitudes.map(req => `<li>${req.aeronave} - ${req.estado}</li>`).join('') : 
                                    '<li>No tiene solicitudes pendientes</li>'}
                            </ul>
                        </div>
                    `;
                    
                    // Botón de editar
                    detailHtml += `
                        <button onclick="showEditPilotForm('${pilot.correo}')">Editar Piloto</button>
                    `;
                    
                    showModal(detailHtml);
                }
            } catch (error) {
                console.error('Error loading pilot details:', error);
            }
        }
        
        // Implementar funciones similares para aeronaves, libros de vuelo, etc.

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar si ya hay una sesión activa
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showView('mainView');
                loadAllData();
            }
        });
    </script>
</body>
</html>
